{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://deckode.dev/schema/deck.json",
  "title": "Deckode Deck",
  "description": "JSON schema for Deckode slide decks",
  "type": "object",
  "required": ["deckode", "meta", "slides"],
  "properties": {
    "deckode": {
      "type": "string",
      "description": "Schema version"
    },
    "meta": {
      "type": "object",
      "required": ["title", "aspectRatio"],
      "properties": {
        "title": { "type": "string" },
        "author": { "type": "string" },
        "aspectRatio": { "type": "string", "enum": ["16:9", "4:3"] }
      }
    },
    "theme": { "$ref": "#/$defs/DeckTheme" },
    "slides": {
      "type": "array",
      "items": { "$ref": "#/$defs/Slide" }
    }
  },
  "$defs": {
    "DeckTheme": {
      "type": "object",
      "description": "Deck-level default styles per element type. Element-level style overrides theme.",
      "properties": {
        "slide": {
          "type": "object",
          "properties": {
            "background": {
              "type": "object",
              "properties": {
                "color": { "type": "string" },
                "image": { "type": "string" }
              }
            }
          }
        },
        "text": {
          "type": "object",
          "properties": {
            "fontFamily": { "type": "string" },
            "fontSize": { "type": "number" },
            "color": { "type": "string" },
            "textAlign": { "type": "string", "enum": ["left", "center", "right"] },
            "lineHeight": { "type": "number" },
            "verticalAlign": { "type": "string", "enum": ["top", "middle", "bottom"] }
          }
        },
        "code": {
          "type": "object",
          "properties": {
            "theme": { "type": "string" },
            "fontSize": { "type": "number" },
            "lineNumbers": { "type": "boolean" },
            "borderRadius": { "type": "number" }
          }
        },
        "shape": {
          "type": "object",
          "properties": {
            "fill": { "type": "string" },
            "stroke": { "type": "string" },
            "strokeWidth": { "type": "number" },
            "borderRadius": { "type": "number" },
            "opacity": { "type": "number" }
          }
        },
        "image": {
          "type": "object",
          "properties": {
            "objectFit": { "type": "string", "enum": ["contain", "cover", "fill"] },
            "borderRadius": { "type": "number" },
            "opacity": { "type": "number" }
          }
        },
        "video": {
          "type": "object",
          "properties": {
            "objectFit": { "type": "string", "enum": ["contain", "cover", "fill"] },
            "borderRadius": { "type": "number" }
          }
        },
        "tikz": {
          "type": "object",
          "properties": {
            "backgroundColor": { "type": "string" },
            "borderRadius": { "type": "number" }
          }
        },
        "table": {
          "type": "object",
          "properties": {
            "fontSize": { "type": "number" },
            "color": { "type": "string" },
            "headerBackground": { "type": "string" },
            "headerColor": { "type": "string" },
            "borderColor": { "type": "string" },
            "striped": { "type": "boolean" },
            "borderRadius": { "type": "number" }
          }
        }
      }
    },
    "Position": {
      "type": "object",
      "required": ["x", "y"],
      "properties": {
        "x": { "type": "number" },
        "y": { "type": "number" }
      }
    },
    "Size": {
      "type": "object",
      "required": ["w", "h"],
      "properties": {
        "w": { "type": "number", "minimum": 0 },
        "h": { "type": "number", "minimum": 0 }
      }
    },
    "Slide": {
      "type": "object",
      "required": ["id", "elements"],
      "properties": {
        "id": { "type": "string" },
        "layout": { "type": "string" },
        "background": {
          "type": "object",
          "properties": {
            "color": { "type": "string" },
            "image": { "type": "string" }
          }
        },
        "transition": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["fade", "slide", "none"] },
            "duration": { "type": "number", "minimum": 0 }
          }
        },
        "notes": { "type": "string" },
        "elements": {
          "type": "array",
          "items": { "$ref": "#/$defs/Element" }
        },
        "animations": {
          "type": "array",
          "items": { "$ref": "#/$defs/Animation" }
        }
      }
    },
    "Element": {
      "type": "object",
      "required": ["id", "type", "position", "size"],
      "properties": {
        "id": { "type": "string" },
        "type": { "type": "string", "enum": ["text", "image", "code", "shape", "video", "tikz", "table", "custom"] },
        "position": { "$ref": "#/$defs/Position" },
        "size": { "$ref": "#/$defs/Size" },
        "rotation": { "type": "number" },
        "content": { "type": "string" },
        "src": { "type": "string" },
        "language": { "type": "string" },
        "shape": { "type": "string", "enum": ["rectangle", "ellipse", "line", "arrow"] },
        "autoplay": { "type": "boolean" },
        "loop": { "type": "boolean" },
        "muted": { "type": "boolean" },
        "controls": { "type": "boolean" },
        "svgUrl": { "type": "string" },
        "preamble": { "type": "string" },
        "columns": { "type": "array", "items": { "type": "string" } },
        "rows": { "type": "array", "items": { "type": "array", "items": { "type": "string" } } },
        "component": { "type": "string" },
        "props": { "type": "object" },
        "style": { "type": "object" }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "text" } } },
          "then": { "required": ["content"] }
        },
        {
          "if": { "properties": { "type": { "const": "image" } } },
          "then": { "required": ["src"] }
        },
        {
          "if": { "properties": { "type": { "const": "code" } } },
          "then": { "required": ["language", "content"] }
        },
        {
          "if": { "properties": { "type": { "const": "shape" } } },
          "then": { "required": ["shape"] }
        },
        {
          "if": { "properties": { "type": { "const": "video" } } },
          "then": { "required": ["src"] }
        },
        {
          "if": { "properties": { "type": { "const": "tikz" } } },
          "then": { "required": ["content"] }
        },
        {
          "if": { "properties": { "type": { "const": "table" } } },
          "then": { "required": ["columns", "rows"] }
        },
        {
          "if": { "properties": { "type": { "const": "custom" } } },
          "then": { "required": ["component"] }
        }
      ]
    },
    "Animation": {
      "type": "object",
      "required": ["target", "trigger", "effect"],
      "properties": {
        "target": { "type": "string" },
        "trigger": { "type": "string", "enum": ["onEnter", "onClick", "onKey", "afterPrevious", "withPrevious"] },
        "effect": {
          "type": "string",
          "enum": [
            "fadeIn", "fadeOut",
            "slideInLeft", "slideInRight", "slideInUp", "slideInDown",
            "scaleIn", "scaleOut", "typewriter"
          ]
        },
        "delay": { "type": "number", "minimum": 0 },
        "duration": { "type": "number", "minimum": 0 },
        "order": { "type": "integer", "minimum": 0 },
        "key": { "type": "string", "minLength": 1 }
      }
    }
  }
}
